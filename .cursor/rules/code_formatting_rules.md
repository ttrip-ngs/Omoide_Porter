# コードフォーマットルール

## 重要：ファイル破損防止のためのルール

コード修正時は以下のルールを**厳格に遵守**してください：

### 基本フォーマット設定

1. **一行の文字数制限**: 88文字（Blackの設定に従う）
2. **インデント**: スペース4つ（Pythonの標準）
3. **タブ使用禁止**: 常にスペースを使用
4. **文字エンコーディング**: UTF-8
5. **改行コード**: LF（Unix形式）

### Python固有のルール

1. **Blackフォーマッタ準拠**:
   - 一行88文字以内
   - ダブルクォート優先
   - トレーリングカンマを適切に配置

2. **インポート文**:
   - 標準ライブラリ → サードパーティ → ローカルの順
   - 各グループ間に空行を挿入
   - `isort`と互換性のあるスタイル

3. **型ヒント**:
   - 可能な限り型ヒントを追加
   - `mypy`のチェックを通すこと

### ファイル修正時の注意事項

1. **エンコーディング保持**:
   - 既存ファイルのエンコーディングを変更しない
   - 日本語コメントがある場合は特に注意

2. **インデント一貫性**:
   - 既存のインデントスタイルを確認
   - 混在させない（スペースとタブを混ぜない）

3. **行末処理**:
   - 行末の空白を削除
   - ファイル末尾に改行を1つ追加

4. **差分最小化**:
   - 必要最小限の変更に留める
   - 不要なフォーマット変更を避ける

### 編集前チェックリスト

- [ ] 既存ファイルの文字エンコーディングを確認
- [ ] 既存のインデントスタイル（スペース/タブ）を確認
- [ ] 一行の長さが88文字以内であることを確認
- [ ] 型ヒントが適切に設定されているか確認

### 編集後チェックリスト

- [ ] Blackフォーマッタでチェック
- [ ] Mypyでの型チェックをパス
- [ ] 文字エンコーディングが保持されている
- [ ] 不要な空白行や文字が追加されていない

### 緊急時の対応

ファイル破損が発生した場合：
1. Git履歴から復元
2. `git checkout HEAD -- <ファイル名>` でリセット
3. 小さな単位で再度修正

### エディタ設定との互換性

VSCode設定 (.vscode/settings.json) との整合性：
- `python.formatting.provider`: "black"
- `editor.formatOnSave`: true
- `files.insertFinalNewline`: true
- `files.trimTrailingWhitespace`: true
- Line length: 88文字（pyproject.tomlのBlack設定）

**このルールに従うことで、ファイル破損を防ぎ、一貫したコード品質を維持できます。**
